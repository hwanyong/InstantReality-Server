<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Calibration - Gemini Robotics</title>
    <meta name="description" content="AI-powered automatic robot calibration using Gemini vision">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Additional styles for calibration page */
        .calibration-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap);
        }

        @media (max-width: 1200px) {
            .calibration-grid {
                grid-template-columns: 1fr;
            }
        }

        .progress-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            height: 8px;
            margin: 12px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--gradient-accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        .calibration-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .calibration-step {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calibration-step.active {
            border-left: 3px solid var(--accent);
        }

        .calibration-step.done {
            opacity: 0.7;
        }

        .calibration-step.done::before {
            content: 'âœ“';
            color: var(--success);
            font-weight: bold;
        }

        .step-icon {
            font-size: 1.5rem;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 500;
        }

        .step-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .json-preview {
            font-family: 'Consolas', monospace;
            font-size: 0.7rem;
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            max-height: 200px;
            overflow: auto;
            white-space: pre-wrap;
        }

        .nav-links {
            display: flex;
            gap: 12px;
        }

        .nav-links a {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.875rem;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }

        .workspace-viz {
            position: relative;
            width: 100%;
            aspect-ratio: 1.2;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        .workspace-viz canvas {
            width: 100%;
            height: 100%;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-group .btn {
            flex: 1;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>ğŸ¯ Robot Calibration</h1>
            <div class="status-bar">
                <nav class="nav-links">
                    <a href="index.html">â† Back to Control</a>
                    <a href="settings.html">Settings</a>
                </nav>
                <span id="connection-status" class="status disconnected">â— Disconnected</span>
            </div>
        </header>

        <main class="main-content calibration-grid">
            <!-- Left Panel: Camera + Visualization -->
            <section>
                <!-- Camera View -->
                <div class="video-section">
                    <h2>ğŸ“¹ Camera View <span style="font-size: 12px; color: var(--text-secondary);">(Calibration uses
                            TopView + QuarterView)</span></h2>
                    <div class="video-grid-4" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div class="video-wrapper">
                            <label style="font-size: 11px; color: var(--accent);">ğŸ¯ TopView</label>
                            <canvas id="camera-0" width="390" height="220"
                                style="border: 2px solid var(--accent); border-radius: 4px; background: #000;"></canvas>
                        </div>
                        <div class="video-wrapper">
                            <label style="font-size: 11px; color: var(--accent);">ğŸ¯ QuarterView</label>
                            <canvas id="camera-1" width="390" height="220"
                                style="border: 2px solid var(--accent); border-radius: 4px; background: #000;"></canvas>
                        </div>
                        <div class="video-wrapper">
                            <label style="font-size: 11px; color: var(--text-secondary);">RightRobot</label>
                            <canvas id="camera-2" width="390" height="220"
                                style="border: 1px solid var(--border); border-radius: 4px; background: #000;"></canvas>
                        </div>
                        <div class="video-wrapper">
                            <label style="font-size: 11px; color: var(--text-secondary);">LeftRobot</label>
                            <canvas id="camera-3" width="390" height="220"
                                style="border: 1px solid var(--border); border-radius: 4px; background: #000;"></canvas>
                        </div>
                    </div>
                    <canvas id="ar-overlay" width="800" height="225" style="display: none;"></canvas>
                    <div class="video-controls" style="margin-top: 8px;">
                        <button id="capture-btn" class="btn">ğŸ“· Capture</button>
                        <button id="detect-base-btn" class="btn">ğŸ” Detect Robot Base</button>
                        <button id="detect-gripper-btn" class="btn">âœ‹ Detect Gripper</button>
                    </div>
                </div>

                <!-- Workspace Visualization -->
                <div class="control-card" style="margin-top: var(--gap);">
                    <h3>ğŸ“ Workspace Map</h3>
                    <div class="workspace-viz">
                        <canvas id="workspace-canvas"></canvas>
                    </div>
                    <div class="stats-grid" style="margin-top: 12px;">
                        <div class="stat-item">
                            <div class="stat-value" id="stat-width">--</div>
                            <div class="stat-label">Width (mm)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-height">--</div>
                            <div class="stat-label">Height (mm)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-points">--</div>
                            <div class="stat-label">Cal Points</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Calibration Controls -->
            <section class="control-section">
                <!-- Auto-Calibration -->
                <div class="control-card">
                    <h3>ğŸ¯ Auto-Calibration</h3>
                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 12px;">
                        AIê°€ ë¡œë´‡ ìœ„ì¹˜ë¥¼ ìë™ ê°ì§€í•˜ê³  ì¹´ë©”ë¼-ë¡œë´‡ ì¢Œí‘œ ë³€í™˜ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
                    </p>

                    <div class="calibration-status" id="cal-status">Ready to calibrate</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="cal-progress"></div>
                    </div>

                    <!-- Calibration Steps -->
                    <div id="cal-steps">
                        <div class="calibration-step" id="step-1">
                            <span class="step-icon">ğŸ¯</span>
                            <div class="step-content">
                                <div class="step-title">ë¡œë´‡ ë² ì´ìŠ¤ ê°ì§€</div>
                                <div class="step-desc">AIê°€ ë¡œë´‡ ê¸°ì¤€ì ì„ ì°¾ìŠµë‹ˆë‹¤</div>
                            </div>
                        </div>
                        <div class="calibration-step" id="step-2">
                            <span class="step-icon">ğŸ”²</span>
                            <div class="step-content">
                                <div class="step-title">ê·¸ë¦¬ë“œ ìº˜ë¦¬ë¸Œë ˆì´ì…˜</div>
                                <div class="step-desc">9ê°œ í¬ì¸íŠ¸ ì´ë™ ë° ê°ì§€</div>
                            </div>
                        </div>
                        <div class="calibration-step" id="step-3">
                            <span class="step-icon">ğŸ“</span>
                            <div class="step-content">
                                <div class="step-title">ë³€í™˜ ê³„ì‚°</div>
                                <div class="step-desc">Homography ë§¤íŠ¸ë¦­ìŠ¤ ê³„ì‚°</div>
                            </div>
                        </div>
                        <div class="calibration-step" id="step-4">
                            <span class="step-icon">ğŸ—ºï¸</span>
                            <div class="step-content">
                                <div class="step-title">ì‘ì—… ë²”ìœ„ ë§¤í•‘</div>
                                <div class="step-desc">IKë¡œ ë„ë‹¬ ê°€ëŠ¥ ì˜ì—­ íƒìƒ‰</div>
                            </div>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="start-cal-btn" class="btn-primary">ğŸš€ Start Calibration</button>
                        <button id="stop-cal-btn" class="btn-danger" disabled>â¹ Stop</button>
                    </div>
                </div>

                <!-- Manual Calibration Controls -->
                <div class="control-card">
                    <h3>ğŸ›ï¸ Manual Grid Control</h3>
                    <div class="ik-inputs">
                        <label>Grid Size:
                            <select id="grid-size">
                                <option value="4">2Ã—2 (4ì )</option>
                                <option value="9" selected>3Ã—3 (9ì )</option>
                                <option value="16">4Ã—4 (16ì )</option>
                            </select>
                        </label>
                        <label>Z Height:
                            <input type="number" id="cal-z" value="120" step="10">
                        </label>
                    </div>
                    <button id="test-grid-btn" class="btn">ğŸ“ Preview Grid Points</button>
                </div>

                <!-- Calibration Quality -->
                <div class="control-card">
                    <h3>ğŸ“Š Calibration Quality</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="stat-mean-err">--</div>
                            <div class="stat-label">Mean Error (mm)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-max-err">--</div>
                            <div class="stat-label">Max Error (mm)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-status">â“</div>
                            <div class="stat-label">Status</div>
                        </div>
                    </div>
                    <button id="verify-cal-btn" class="btn" style="width: 100%; margin-top: 12px;">ğŸ”¬ Verify
                        Calibration</button>
                </div>

                <!-- Calibration Data -->
                <div class="control-card">
                    <h3>ğŸ’¾ calibration.json</h3>
                    <pre id="json-preview" class="json-preview">No calibration data</pre>
                    <div class="btn-group">
                        <button id="load-cal-btn" class="btn">ğŸ“‚ Load</button>
                        <button id="save-cal-btn" class="btn">ğŸ’¾ Save</button>
                        <button id="export-cal-btn" class="btn">ğŸ“¤ Export</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script type="module" src="calibration.mjs"></script>
</body>

</html>